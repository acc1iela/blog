[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.8","content-config-digest","74395ff2c1415da1","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"attribute\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[],\"rehypePlugins\":[],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false}}","blog",["Map",11,12,52,53],"rebuild",{"id":11,"data":13,"body":21,"filePath":22,"digest":23,"rendered":24,"legacyId":51},{"title":14,"description":15,"tags":16,"publishedAt":19,"draft":20},"ブログをAstroで作り直した","Next.jsで作ってた個人ブログをAstroで書き直した話",[17,18],"雑記","Astro",["Date","2026-01-11T00:00:00.000Z"],false,"## 作り直した理由\n\n元々 Next.js + Sanity で作ってたんだけど、正直ブログにはオーバースペックだった。\nAPI ルートもサーバーアクションも使わないし、Sanity の管理画面を開くのも面倒になってた。\n\nで、前から気になってた Astro を試してみたら、これがちょうど良かった。\n\n## Astro の良いところ\n\n### Markdown をそのまま記事にできる\n\n`src/content/blog/` に md ファイルを置くだけで記事になる。\nCMS にログインして記事書いて...みたいな手間がない。VSCode で書いて push すれば終わり。\n\n### 必要なところだけ React が使える\n\n基本は静的 HTML を吐くだけなんだけど、検索ボックスとかダークモード切替みたいな\nインタラクティブな部分だけ React コンポーネントを使える。\n\n```astro\n\u003C!-- 静的な部分はそのまま -->\n\u003CHeader />\n\n\u003C!-- ここだけReactでハイドレート -->\n\u003CSearchBox client:load />\n```\n\n### ビルドが爆速\n\nNext.js より明らかに速い。記事増えてもそんなに変わらなそう。\n\n## 構成\n\n- Astro 5\n- Tailwind CSS\n- Content Collections（Markdown 管理）\n- Vercel にデプロイ\n\nシンプルで気に入ってる。","src/content/blog/rebuild.md","151d05c0e69133b4",{"html":25,"metadata":26},"\u003Ch2 id=\"作り直した理由\">作り直した理由\u003C/h2>\n\u003Cp>元々 Next.js + Sanity で作ってたんだけど、正直ブログにはオーバースペックだった。\nAPI ルートもサーバーアクションも使わないし、Sanity の管理画面を開くのも面倒になってた。\u003C/p>\n\u003Cp>で、前から気になってた Astro を試してみたら、これがちょうど良かった。\u003C/p>\n\u003Ch2 id=\"astro-の良いところ\">Astro の良いところ\u003C/h2>\n\u003Ch3 id=\"markdown-をそのまま記事にできる\">Markdown をそのまま記事にできる\u003C/h3>\n\u003Cp>\u003Ccode>src/content/blog/\u003C/code> に md ファイルを置くだけで記事になる。\nCMS にログインして記事書いて…みたいな手間がない。VSCode で書いて push すれば終わり。\u003C/p>\n\u003Ch3 id=\"必要なところだけ-react-が使える\">必要なところだけ React が使える\u003C/h3>\n\u003Cp>基本は静的 HTML を吐くだけなんだけど、検索ボックスとかダークモード切替みたいな\nインタラクティブな部分だけ React コンポーネントを使える。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"astro\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">&#x3C;!-- 静的な部分はそのまま -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">Header\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> />\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">&#x3C;!-- ここだけReactでハイドレート -->\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">SearchBox\u003C/span>\u003Cspan style=\"color:#B392F0\"> client:load\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> />\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"ビルドが爆速\">ビルドが爆速\u003C/h3>\n\u003Cp>Next.js より明らかに速い。記事増えてもそんなに変わらなそう。\u003C/p>\n\u003Ch2 id=\"構成\">構成\u003C/h2>\n\u003Cul>\n\u003Cli>Astro 5\u003C/li>\n\u003Cli>Tailwind CSS\u003C/li>\n\u003Cli>Content Collections（Markdown 管理）\u003C/li>\n\u003Cli>Vercel にデプロイ\u003C/li>\n\u003C/ul>\n\u003Cp>シンプルで気に入ってる。\u003C/p>",{"headings":27,"localImagePaths":45,"remoteImagePaths":46,"frontmatter":47,"imagePaths":50},[28,31,34,38,41,43],{"depth":29,"slug":30,"text":30},2,"作り直した理由",{"depth":29,"slug":32,"text":33},"astro-の良いところ","Astro の良いところ",{"depth":35,"slug":36,"text":37},3,"markdown-をそのまま記事にできる","Markdown をそのまま記事にできる",{"depth":35,"slug":39,"text":40},"必要なところだけ-react-が使える","必要なところだけ React が使える",{"depth":35,"slug":42,"text":42},"ビルドが爆速",{"depth":29,"slug":44,"text":44},"構成",[],[],{"title":14,"description":15,"tags":48,"publishedAt":49},[17,18],["Date","2026-01-11T00:00:00.000Z"],[],"rebuild.md","union_or_discriminatedunion",{"id":52,"data":54,"body":60,"filePath":61,"digest":62,"rendered":63,"legacyId":125},{"title":55,"description":56,"tags":57,"publishedAt":59,"draft":20},"Union型と判別可能ユニオンを使いこなしたい","TypeScriptの判別可能ユニオン（Discriminated Union）で型安全なコードを書く方法",[58],"TypeScript",["Date","2026-01-14T00:00:00.000Z"],"## そもそも Union 型とは\n\nTypeScript を使っていると複数の型をまとめる**Union 型（共用体）**にお世話になることは多いと思います。\nただ、単に型を `|` で繋げただけでは型の絞り込み（Type Narrowing）がうまくいかずコードが冗長になったり予期せぬバグを生んだりすることがあります。\n\nそこで登場するのが、**判別可能ユニオン（Discriminated Union）**。\nこの記事では通常の Union 型で起こりがちな問題とそれを判別可能ユニオンでどう解決するかそしてその強力なメリットについて解説したいと思います。\n\n## 単純な Union 型の落とし穴\n\n例えば、非同期処理の状態管理を考えてみる。\n「読み込み中」「成功」「失敗」の 3 つの状態を持つオブジェクトを定義したい場合。\n\nまずは直感的に書いてしまいがちな「悪い例」です。\n\n```typescript\ntype State = {\n  status: 'loading' | 'success' | 'error';\n  data?: User;\n  error?: Error;\n};\n```\n\nこの定義でも動くには動くが、大きな問題がある。\n**「不正な状態」を許容してしまう**ことです。\n\n例えば、以下のようなオブジェクトも型定義上は「正しい」ことになってしまう。\n\n```typescript\n// statusは 'loading' なのに data がある？\nconst invalidState1: State = {\n  status: 'loading',\n  data: { id: 1, name: 'Alice' },\n};\n\n// statusは'success'なのにdataがない？\nconst invalidState2: State = {\n  status: 'success',\n  // dataプロパティが欠落していてもdata?なのでエラーにならない...\n};\n```\n\nまた、この型を使う側でも毎回プロパティの存在チェックが必要になります。\n\n```typescript\nfunction render(state: State) {\n  if (state.status === 'success') {\n    // state.dataはundefinedの可能性があるので、?.や!が必要になる...\n    console.log(state.data?.name);\n  }\n}\n```\n\nこれでは TypeScript の恩恵を十分に受けられていない。\n\n## 判別可能ユニオン（Discriminated Union）の登場\n\nこの問題を解決するのが、**判別可能ユニオン**。\n判別可能ユニオンとは、**「共通のリテラル型プロパティ（ディスクリミネータ）」を持つオブジェクト型の Union**のことです。\n\n先ほどの例をリファクタリングしてみる。\n\n```typescript\ntype LoadingState = {\n  status: 'loading';\n};\n\ntype SuccessState = {\n  status: 'success';\n  data: User;\n};\n\ntype ErrorState = {\n  status: 'error';\n  error: Error;\n};\n\n// これらを Union でまとめる\ntype State = LoadingState | SuccessState | ErrorState;\n```\n\nここでのポイントは以下の 2 点です。\n\n1.  各状態を個別の型として定義したこと\n2.  全ての型に共通の `status` プロパティ（ディスクリミネータ）を持たせ、それぞれ固有のリテラル型（`'loading'`, `'success'`, `'error'`）を割り当てたこと\n\n## なぜこれが嬉しいのか？（Type Narrowing）\n\n判別可能ユニオンを使う最大のメリットは、**制御フロー解析（Control Flow Analysis）による型の絞り込み**が効くこと。\n\n`if` 文や`switch`文で`status`をチェックすると、TypeScript は自動的にそのブロック内での型を特定してくれます。\n\n```typescript\nfunction render(state: State) {\n  if (state.status === 'loading') {\n    // ここでは state は LoadingState 型として扱われる\n    console.log('Loading...');\n  } else if (state.status === 'success') {\n    // ここでは state は SuccessState 型として扱われる\n    // そのため、data プロパティには確実にアクセスできる（? や ! は不要！）\n    console.log(`Hello, ${state.data.name}`);\n  } else {\n    // ここでは state は ErrorState 型\n    console.error(state.error.message);\n  }\n}\n```\n\nこのように、`status`が`'success'`であることが確定した時点で、`data`プロパティが存在することが保証されます。\n逆に、`status`が`'loading'`のときに`data`にアクセスしようとすると、コンパイルエラーになります。\n\nこれが「不正な状態を型レベルで防ぐ」ということ。\n\n## 実践的なユースケース：状態管理とドメインモデル\n\n判別可能ユニオンは、単なるエラーハンドリングだけでなく、アプリケーションの状態管理やドメインモデリングでかなり役立つ。\n\n### 1. 画面の UI 状態管理\n\n画面の描画状態を管理する際、`isLoading`や`isError`といった複数のフラグで管理しようとすると、組み合わせの爆発が起き、あり得ない状態（ロード中かつエラー、など）が発生しがちです。\n\n```typescript\n// ❌ 悪い例：複数のフラグで管理\ntype UIState = {\n  isLoading: boolean;\n  isError: boolean;\n  data?: User;\n  error?: Error;\n};\n// isLoading: true, isError: true みたいな矛盾した状態が作れてしまう\n```\n\nこれを判別可能ユニオンで定義すれば、状態は常に一つであることが保証される。\n\n```typescript\n// ✅ 良い例：状態をユニオンで定義\ntype UIState =\n  | { status: 'idle' }\n  | { status: 'loading' }\n  | { status: 'success'; data: User }\n  | { status: 'error'; error: Error };\n```\n\n### 2. ドメインモデル：決済方法\n\nEC サイトなどで、決済方法によって必要な情報が異なるケースも綺麗に表現できる。\n\n```typescript\ntype CreditCard = {\n  method: 'credit-card';\n  cardNumber: string;\n  cvc: string;\n  expirationDate: string;\n};\n\ntype BankTransfer = {\n  method: 'bank-transfer';\n  bankCode: string;\n  branchCode: string;\n  accountNumber: string;\n};\n\ntype PayPal = {\n  method: 'paypal';\n  email: string;\n};\n\ntype PaymentMethod = CreditCard | BankTransfer | PayPal;\n\nfunction processPayment(payment: PaymentMethod) {\n  switch (payment.method) {\n    case 'credit-card':\n      // payment は CreditCard 型\n      sendToPaymentGateway(payment.cardNumber);\n      break;\n    case 'bank-transfer':\n      // payment は BankTransfer 型\n      showBankInfo(payment.bankCode);\n      break;\n    case 'paypal':\n      // payment は PayPal 型\n      redirectToPayPal(payment.email);\n      break;\n  }\n}\n```\n\n## 深掘り：Optional Property (`?`) の危険性\n\nTypeScript 初心者がやりがちなのが、とりあえず`?`をつけて Optional Property にしてしまうことです。これは多くの場合、**「あり得ない状態」**を生み出す温床になります。\n\n### なぜ `?` は危険なのか\n\n例えば、ユーザーの設定情報を表す型を考えてみましょう。\n「通知設定が ON の場合は、通知先のメールアドレスが必須」という仕様があるとする。\n\n```typescript\n// ❌ 危険な定義\ntype UserSettings = {\n  notificationsEnabled: boolean;\n  notificationEmail?: string; // ONのとき必須なのに、型上は省略可能...\n};\n```\n\nこの定義では、以下のバグを許容してしまいます。\n\n1.  `notificationsEnabled: true` なのに `notificationEmail` が `undefined`\n2.  `notificationsEnabled: false` なのに `notificationEmail` が入っている（これはバグではないかもしれないが、データの整合性としては不自然）\n\n### ユニオン型による解決\n\nこれを判別可能ユニオンで書き直すと、仕様を型定義に直接落とし込むことができます。\n\n```typescript\n// ✅ 安全な定義\ntype NotificationsOn = {\n  enabled: true;\n  email: string; // 必須！\n};\n\ntype NotificationsOff = {\n  enabled: false;\n};\n\ntype UserSettings = NotificationsOn | NotificationsOff;\n\n// 使用例\nconst settings: UserSettings = {\n  enabled: true,\n  // email: 'test@example.com' // これを書き忘れるとコンパイルエラーになる！\n};\n```\n\nこのように、**「値の組み合わせ」に制約を持たせる**ことができるのがユニオン型の強みです。単にプロパティをオプショナルにする前に、「それは本当に独立して存在できる値なのか？それとも他の値と連動しているのか？」を考える癖をつけると、堅牢な設計になります。\n\n### 3. API レスポンスのハンドリング\n\nAPI の結果を`Result`型として定義する場合によく使われます。\n\n```typescript\ntype Success\u003CT> = { type: 'ok'; value: T };\ntype Failure = { type: 'error'; error: Error };\n\ntype Result\u003CT> = Success\u003CT> | Failure;\n\nfunction handleResult(result: Result\u003CUser>) {\n  if (result.type === 'ok') {\n    console.log(result.value);\n  } else {\n    console.error(result.error);\n  }\n}\n```\n\n### 4. Reducer のアクション（Redux / useReducer）\n\nRedux や React の`useReducer`を使う際のアクション定義は、まさに判別可能ユニオンの教科書的な例です。\n\n```typescript\ntype Action =\n  | { type: 'INCREMENT' }\n  | { type: 'DECREMENT' }\n  | { type: 'SET_VALUE'; payload: number };\n\nfunction reducer(state: number, action: Action) {\n  switch (action.type) {\n    case 'INCREMENT':\n      return state + 1;\n    case 'DECREMENT':\n      return state - 1;\n    case 'SET_VALUE':\n      // typeが 'SET_VALUE' のときだけ payload にアクセスできる\n      return action.payload;\n  }\n}\n```\n\n## TypeScript 5.x と `satisfies`\n\nTypeScript 4.9 (5.x 系でも重要) で導入された `satisfies` オペレーターを使うと、ユニオン型をより柔軟に扱えます。\n\n例えば、設定オブジェクトで「キーは決まっているが、値は文字列か RGB 配列のどちらか」というケースです。\n\n```typescript\ntype Color = string | [number, number, number];\ntype ThemeConfig = {\n  primary: Color;\n  secondary: Color;\n};\n\n// satisfies を使うと、型チェックをしつつ、より具体的な型情報を保持できる\nconst theme = {\n  primary: 'blue',\n  secondary: [255, 255, 255],\n} satisfies ThemeConfig;\n\n// theme.primary は 'string' 型として推論されるので、stringのメソッドが使える\nconsole.log(theme.primary.toUpperCase());\n\n// theme.secondary はタプル型として推論される\nconsole.log(theme.secondary[0]);\n```\n\nもし `const theme: ThemeConfig = ...` と書いてしまうと、`theme.primary` は `string | [number, number, number]` 型にワイドニング（広げられて）されてしまい、`toUpperCase()` を呼ぶ前に型チェックが必要になってしまいます。`satisfies` はこの問題を解決します。\n\n## 現代技術との接続：Zod と RSC\n\n判別可能ユニオンは、最新のライブラリやフレームワークとも相性抜群です。\n\n### Zod によるランタイム型チェック\n\n外部からの入力（API レスポンスやフォーム入力）を判別可能ユニオンとして検証するには、[Zod](https://zod.dev/) の `z.discriminatedUnion` が便利です。\n\n```typescript\nimport { z } from 'zod';\n\nconst LoadingState = z.object({ status: z.literal('loading') });\nconst SuccessState = z.object({ status: z.literal('success'), data: z.string() });\nconst ErrorState = z.object({ status: z.literal('error'), error: z.instanceof(Error) });\n\nconst StateSchema = z.discriminatedUnion('status', [LoadingState, SuccessState, ErrorState]);\n\n// 実行時にデータを検証し、型安全なオブジェクトを返す\nconst result = StateSchema.safeParse(apiResponse);\nif (result.success) {\n  const state = result.data; // ここで state は判別可能ユニオン型になる\n}\n```\n\n### React Server Components (RSC)\n\nNext.js などの RSC では、Server Action からクライアントに結果を返す際に判別可能ユニオンが役立つ。\n\n```typescript\n// server-action.ts\n'use server';\n\ntype ActionState =\n  | { status: 'idle' }\n  | { status: 'success'; message: string }\n  | { status: 'error'; errors: Record\u003Cstring, string[]> };\n\nexport async function submitForm(prevState: ActionState, formData: FormData): Promise\u003CActionState> {\n  // ...処理...\n  if (error) {\n    return { status: 'error', errors: validationErrors };\n  }\n  return { status: 'success', message: '送信しました' };\n}\n```\n\nクライアント側では `status` をチェックするだけで、エラー表示や成功メッセージの表示を安全に分岐できる。\n\n## 応用：網羅性チェック（Exhaustiveness Checking）\n\n判別可能ユニオンと `switch` 文を組み合わせる際、**「全てのパターンを網羅しているか」**をコンパイラにチェックさせることができる。\nこれには `never` 型を利用する。\n\n```typescript\nfunction assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\nfunction render(state: State) {\n  switch (state.status) {\n    case 'loading':\n      return 'Loading...';\n    case 'success':\n      return `Hello ${state.data.name}`;\n    case 'error':\n      return `Error: ${state.error.message}`;\n    default:\n      // もし将来 State に新しい型（例: 'idle'）が追加された場合、\n      // ここで型エラーが発生するようになります。\n      return assertNever(state);\n  }\n}\n```\n\n`default`節で`state`を`never`型に代入しようとすることで、もし`case`の漏れがあれば`state`が`never`にならず（残りの型になるため）、コンパイルエラーが発生する。\nこれで将来的な仕様変更によるバグを未然に防げる。\n\n## まとめ\n\n- 単純な Union 型ではなく、**判別可能ユニオン（Discriminated Union）**を使う\n- 共通のプロパティ（ディスクリミネータ）を持たせることで TypeScript が型を自動的に絞り込んでくれる\n- これにより、`?`や`as`を使わずに安全にプロパティにアクセスでき、バグを減らせる\n- `never`型を使った網羅性チェックを導入すれば、保守性もさらに向上する\n\n型定義を少し工夫するだけで、コードの安全性と可読性は劇的に向上する。","src/content/blog/union_or_discriminatedunion.md","37bc651b1f00810a",{"html":64,"metadata":65},"\u003Ch2 id=\"そもそも-union-型とは\">そもそも Union 型とは\u003C/h2>\n\u003Cp>TypeScript を使っていると複数の型をまとめる**Union 型（共用体）**にお世話になることは多いと思います。\nただ、単に型を \u003Ccode>|\u003C/code> で繋げただけでは型の絞り込み（Type Narrowing）がうまくいかずコードが冗長になったり予期せぬバグを生んだりすることがあります。\u003C/p>\n\u003Cp>そこで登場するのが、\u003Cstrong>判別可能ユニオン（Discriminated Union）\u003C/strong>。\nこの記事では通常の Union 型で起こりがちな問題とそれを判別可能ユニオンでどう解決するかそしてその強力なメリットについて解説したいと思います。\u003C/p>\n\u003Ch2 id=\"単純な-union-型の落とし穴\">単純な Union 型の落とし穴\u003C/h2>\n\u003Cp>例えば、非同期処理の状態管理を考えてみる。\n「読み込み中」「成功」「失敗」の 3 つの状態を持つオブジェクトを定義したい場合。\u003C/p>\n\u003Cp>まずは直感的に書いてしまいがちな「悪い例」です。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'loading'\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  data\u003C/span>\u003Cspan style=\"color:#F97583\">?:\u003C/span>\u003Cspan style=\"color:#B392F0\"> User\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  error\u003C/span>\u003Cspan style=\"color:#F97583\">?:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>この定義でも動くには動くが、大きな問題がある。\n\u003Cstrong>「不正な状態」を許容してしまう\u003C/strong>ことです。\u003C/p>\n\u003Cp>例えば、以下のようなオブジェクトも型定義上は「正しい」ことになってしまう。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// statusは 'loading' なのに data がある？\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> invalidState1\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  status: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  data: { id: \u003C/span>\u003Cspan style=\"color:#79B8FF\">1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, name: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'Alice'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// statusは'success'なのにdataがない？\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> invalidState2\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  status: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">  // dataプロパティが欠落していてもdata?なのでエラーにならない...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>また、この型を使う側でも毎回プロパティの存在チェックが必要になります。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> render\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">state\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (state.status \u003C/span>\u003Cspan style=\"color:#F97583\">===\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // state.dataはundefinedの可能性があるので、?.や!が必要になる...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(state.data?.name);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>これでは TypeScript の恩恵を十分に受けられていない。\u003C/p>\n\u003Ch2 id=\"判別可能ユニオンdiscriminated-unionの登場\">判別可能ユニオン（Discriminated Union）の登場\u003C/h2>\n\u003Cp>この問題を解決するのが、\u003Cstrong>判別可能ユニオン\u003C/strong>。\n判別可能ユニオンとは、\u003Cstrong>「共通のリテラル型プロパティ（ディスクリミネータ）」を持つオブジェクト型の Union\u003C/strong>のことです。\u003C/p>\n\u003Cp>先ほどの例をリファクタリングしてみる。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> LoadingState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> SuccessState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  data\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> User\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> ErrorState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  error\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// これらを Union でまとめる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#B392F0\"> LoadingState\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#B392F0\"> SuccessState\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#B392F0\"> ErrorState\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>ここでのポイントは以下の 2 点です。\u003C/p>\n\u003Col>\n\u003Cli>各状態を個別の型として定義したこと\u003C/li>\n\u003Cli>全ての型に共通の \u003Ccode>status\u003C/code> プロパティ（ディスクリミネータ）を持たせ、それぞれ固有のリテラル型（\u003Ccode>'loading'\u003C/code>, \u003Ccode>'success'\u003C/code>, \u003Ccode>'error'\u003C/code>）を割り当てたこと\u003C/li>\n\u003C/ol>\n\u003Ch2 id=\"なぜこれが嬉しいのかtype-narrowing\">なぜこれが嬉しいのか？（Type Narrowing）\u003C/h2>\n\u003Cp>判別可能ユニオンを使う最大のメリットは、\u003Cstrong>制御フロー解析（Control Flow Analysis）による型の絞り込み\u003C/strong>が効くこと。\u003C/p>\n\u003Cp>\u003Ccode>if\u003C/code> 文や\u003Ccode>switch\u003C/code>文で\u003Ccode>status\u003C/code>をチェックすると、TypeScript は自動的にそのブロック内での型を特定してくれます。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> render\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">state\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (state.status \u003C/span>\u003Cspan style=\"color:#F97583\">===\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // ここでは state は LoadingState 型として扱われる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'Loading...'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  } \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#F97583\"> if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (state.status \u003C/span>\u003Cspan style=\"color:#F97583\">===\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // ここでは state は SuccessState 型として扱われる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // そのため、data プロパティには確実にアクセスできる（? や ! は不要！）\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">`Hello, ${\u003C/span>\u003Cspan style=\"color:#E1E4E8\">state\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">data\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">name\u003C/span>\u003Cspan style=\"color:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  } \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">    // ここでは state は ErrorState 型\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(state.error.message);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>このように、\u003Ccode>status\u003C/code>が\u003Ccode>'success'\u003C/code>であることが確定した時点で、\u003Ccode>data\u003C/code>プロパティが存在することが保証されます。\n逆に、\u003Ccode>status\u003C/code>が\u003Ccode>'loading'\u003C/code>のときに\u003Ccode>data\u003C/code>にアクセスしようとすると、コンパイルエラーになります。\u003C/p>\n\u003Cp>これが「不正な状態を型レベルで防ぐ」ということ。\u003C/p>\n\u003Ch2 id=\"実践的なユースケース状態管理とドメインモデル\">実践的なユースケース：状態管理とドメインモデル\u003C/h2>\n\u003Cp>判別可能ユニオンは、単なるエラーハンドリングだけでなく、アプリケーションの状態管理やドメインモデリングでかなり役立つ。\u003C/p>\n\u003Ch3 id=\"1-画面の-ui-状態管理\">1. 画面の UI 状態管理\u003C/h3>\n\u003Cp>画面の描画状態を管理する際、\u003Ccode>isLoading\u003C/code>や\u003Ccode>isError\u003C/code>といった複数のフラグで管理しようとすると、組み合わせの爆発が起き、あり得ない状態（ロード中かつエラー、など）が発生しがちです。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// ❌ 悪い例：複数のフラグで管理\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> UIState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  isLoading\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> boolean\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  isError\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> boolean\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  data\u003C/span>\u003Cspan style=\"color:#F97583\">?:\u003C/span>\u003Cspan style=\"color:#B392F0\"> User\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  error\u003C/span>\u003Cspan style=\"color:#F97583\">?:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// isLoading: true, isError: true みたいな矛盾した状態が作れてしまう\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>これを判別可能ユニオンで定義すれば、状態は常に一つであることが保証される。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// ✅ 良い例：状態をユニオンで定義\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> UIState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'idle'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">data\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> User\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">error\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"2-ドメインモデル決済方法\">2. ドメインモデル：決済方法\u003C/h3>\n\u003Cp>EC サイトなどで、決済方法によって必要な情報が異なるケースも綺麗に表現できる。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> CreditCard\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  method\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'credit-card'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  cardNumber\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  cvc\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  expirationDate\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> BankTransfer\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  method\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'bank-transfer'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  bankCode\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  branchCode\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  accountNumber\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> PayPal\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  method\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'paypal'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  email\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> PaymentMethod\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#B392F0\"> CreditCard\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#B392F0\"> BankTransfer\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#B392F0\"> PayPal\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> processPayment\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">payment\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> PaymentMethod\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  switch\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (payment.method) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'credit-card'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // payment は CreditCard 型\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">      sendToPaymentGateway\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(payment.cardNumber);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      break\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'bank-transfer'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // payment は BankTransfer 型\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">      showBankInfo\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(payment.bankCode);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      break\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'paypal'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // payment は PayPal 型\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#B392F0\">      redirectToPayPal\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(payment.email);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      break\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"深掘りoptional-property--の危険性\">深掘り：Optional Property (\u003Ccode>?\u003C/code>) の危険性\u003C/h2>\n\u003Cp>TypeScript 初心者がやりがちなのが、とりあえず\u003Ccode>?\u003C/code>をつけて Optional Property にしてしまうことです。これは多くの場合、**「あり得ない状態」**を生み出す温床になります。\u003C/p>\n\u003Ch3 id=\"なぜ--は危険なのか\">なぜ \u003Ccode>?\u003C/code> は危険なのか\u003C/h3>\n\u003Cp>例えば、ユーザーの設定情報を表す型を考えてみましょう。\n「通知設定が ON の場合は、通知先のメールアドレスが必須」という仕様があるとする。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// ❌ 危険な定義\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> UserSettings\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  notificationsEnabled\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> boolean\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  notificationEmail\u003C/span>\u003Cspan style=\"color:#F97583\">?:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#6A737D\">// ONのとき必須なのに、型上は省略可能...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>この定義では、以下のバグを許容してしまいます。\u003C/p>\n\u003Col>\n\u003Cli>\u003Ccode>notificationsEnabled: true\u003C/code> なのに \u003Ccode>notificationEmail\u003C/code> が \u003Ccode>undefined\u003C/code>\u003C/li>\n\u003Cli>\u003Ccode>notificationsEnabled: false\u003C/code> なのに \u003Ccode>notificationEmail\u003C/code> が入っている（これはバグではないかもしれないが、データの整合性としては不自然）\u003C/li>\n\u003C/ol>\n\u003Ch3 id=\"ユニオン型による解決\">ユニオン型による解決\u003C/h3>\n\u003Cp>これを判別可能ユニオンで書き直すと、仕様を型定義に直接落とし込むことができます。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// ✅ 安全な定義\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> NotificationsOn\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  enabled\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> true\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  email\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#6A737D\">// 必須！\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> NotificationsOff\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  enabled\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> false\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> UserSettings\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#B392F0\"> NotificationsOn\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#B392F0\"> NotificationsOff\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// 使用例\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> settings\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> UserSettings\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  enabled: \u003C/span>\u003Cspan style=\"color:#79B8FF\">true\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">  // email: 'test@example.com' // これを書き忘れるとコンパイルエラーになる！\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>このように、\u003Cstrong>「値の組み合わせ」に制約を持たせる\u003C/strong>ことができるのがユニオン型の強みです。単にプロパティをオプショナルにする前に、「それは本当に独立して存在できる値なのか？それとも他の値と連動しているのか？」を考える癖をつけると、堅牢な設計になります。\u003C/p>\n\u003Ch3 id=\"3-api-レスポンスのハンドリング\">3. API レスポンスのハンドリング\u003C/h3>\n\u003Cp>API の結果を\u003Ccode>Result\u003C/code>型として定義する場合によく使われます。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> Success\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">T\u003C/span>\u003Cspan style=\"color:#E1E4E8\">> \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">type\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'ok'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">value\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> T\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> Failure\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">type\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">error\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> Result\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">T\u003C/span>\u003Cspan style=\"color:#E1E4E8\">> \u003C/span>\u003Cspan style=\"color:#F97583\">=\u003C/span>\u003Cspan style=\"color:#B392F0\"> Success\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">T\u003C/span>\u003Cspan style=\"color:#E1E4E8\">> \u003C/span>\u003Cspan style=\"color:#F97583\">|\u003C/span>\u003Cspan style=\"color:#B392F0\"> Failure\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> handleResult\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">result\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Result\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">User\u003C/span>\u003Cspan style=\"color:#E1E4E8\">>) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (result.type \u003C/span>\u003Cspan style=\"color:#F97583\">===\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'ok'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(result.value);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  } \u003C/span>\u003Cspan style=\"color:#F97583\">else\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">    console.\u003C/span>\u003Cspan style=\"color:#B392F0\">error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(result.error);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"4-reducer-のアクションredux--usereducer\">4. Reducer のアクション（Redux / useReducer）\u003C/h3>\n\u003Cp>Redux や React の\u003Ccode>useReducer\u003C/code>を使う際のアクション定義は、まさに判別可能ユニオンの教科書的な例です。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> Action\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">type\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'INCREMENT'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">type\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'DECREMENT'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">type\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'SET_VALUE'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">payload\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> number\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> reducer\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">state\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> number\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#FFAB70\">action\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Action\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  switch\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (action.type) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'INCREMENT'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> state \u003C/span>\u003Cspan style=\"color:#F97583\">+\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'DECREMENT'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> state \u003C/span>\u003Cspan style=\"color:#F97583\">-\u003C/span>\u003Cspan style=\"color:#79B8FF\"> 1\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'SET_VALUE'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // typeが 'SET_VALUE' のときだけ payload にアクセスできる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> action.payload;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch2 id=\"typescript-5x-と-satisfies\">TypeScript 5.x と \u003Ccode>satisfies\u003C/code>\u003C/h2>\n\u003Cp>TypeScript 4.9 (5.x 系でも重要) で導入された \u003Ccode>satisfies\u003C/code> オペレーターを使うと、ユニオン型をより柔軟に扱えます。\u003C/p>\n\u003Cp>例えば、設定オブジェクトで「キーは決まっているが、値は文字列か RGB 配列のどちらか」というケースです。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> Color\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#F97583\"> |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> [\u003C/span>\u003Cspan style=\"color:#79B8FF\">number\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">number\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">number\u003C/span>\u003Cspan style=\"color:#E1E4E8\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> ThemeConfig\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  primary\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Color\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#FFAB70\">  secondary\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Color\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// satisfies を使うと、型チェックをしつつ、より具体的な型情報を保持できる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> theme\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  primary: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'blue'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  secondary: [\u003C/span>\u003Cspan style=\"color:#79B8FF\">255\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">255\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">255\u003C/span>\u003Cspan style=\"color:#E1E4E8\">],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">} \u003C/span>\u003Cspan style=\"color:#F97583\">satisfies\u003C/span>\u003Cspan style=\"color:#B392F0\"> ThemeConfig\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// theme.primary は 'string' 型として推論されるので、stringのメソッドが使える\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(theme.primary.\u003C/span>\u003Cspan style=\"color:#B392F0\">toUpperCase\u003C/span>\u003Cspan style=\"color:#E1E4E8\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// theme.secondary はタプル型として推論される\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">console.\u003C/span>\u003Cspan style=\"color:#B392F0\">log\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(theme.secondary[\u003C/span>\u003Cspan style=\"color:#79B8FF\">0\u003C/span>\u003Cspan style=\"color:#E1E4E8\">]);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>もし \u003Ccode>const theme: ThemeConfig = ...\u003C/code> と書いてしまうと、\u003Ccode>theme.primary\u003C/code> は \u003Ccode>string | [number, number, number]\u003C/code> 型にワイドニング（広げられて）されてしまい、\u003Ccode>toUpperCase()\u003C/code> を呼ぶ前に型チェックが必要になってしまいます。\u003Ccode>satisfies\u003C/code> はこの問題を解決します。\u003C/p>\n\u003Ch2 id=\"現代技術との接続zod-と-rsc\">現代技術との接続：Zod と RSC\u003C/h2>\n\u003Cp>判別可能ユニオンは、最新のライブラリやフレームワークとも相性抜群です。\u003C/p>\n\u003Ch3 id=\"zod-によるランタイム型チェック\">Zod によるランタイム型チェック\u003C/h3>\n\u003Cp>外部からの入力（API レスポンスやフォーム入力）を判別可能ユニオンとして検証するには、\u003Ca href=\"https://zod.dev/\">Zod\u003C/a> の \u003Ccode>z.discriminatedUnion\u003C/code> が便利です。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">import\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { z } \u003C/span>\u003Cspan style=\"color:#F97583\">from\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'zod'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> LoadingState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> z.\u003C/span>\u003Cspan style=\"color:#B392F0\">object\u003C/span>\u003Cspan style=\"color:#E1E4E8\">({ status: z.\u003C/span>\u003Cspan style=\"color:#B392F0\">literal\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> SuccessState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> z.\u003C/span>\u003Cspan style=\"color:#B392F0\">object\u003C/span>\u003Cspan style=\"color:#E1E4E8\">({ status: z.\u003C/span>\u003Cspan style=\"color:#B392F0\">literal\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), data: z.\u003C/span>\u003Cspan style=\"color:#B392F0\">string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">() });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> ErrorState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> z.\u003C/span>\u003Cspan style=\"color:#B392F0\">object\u003C/span>\u003Cspan style=\"color:#E1E4E8\">({ status: z.\u003C/span>\u003Cspan style=\"color:#B392F0\">literal\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">), error: z.\u003C/span>\u003Cspan style=\"color:#B392F0\">instanceof\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(Error) });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> StateSchema\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> z.\u003C/span>\u003Cspan style=\"color:#B392F0\">discriminatedUnion\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'status'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, [LoadingState, SuccessState, ErrorState]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// 実行時にデータを検証し、型安全なオブジェクトを返す\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> result\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> StateSchema.\u003C/span>\u003Cspan style=\"color:#B392F0\">safeParse\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(apiResponse);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (result.success) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  const\u003C/span>\u003Cspan style=\"color:#79B8FF\"> state\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> result.data; \u003C/span>\u003Cspan style=\"color:#6A737D\">// ここで state は判別可能ユニオン型になる\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Ch3 id=\"react-server-components-rsc\">React Server Components (RSC)\u003C/h3>\n\u003Cp>Next.js などの RSC では、Server Action からクライアントに結果を返す際に判別可能ユニオンが役立つ。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">// server-action.ts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#9ECBFF\">'use server'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">type\u003C/span>\u003Cspan style=\"color:#B392F0\"> ActionState\u003C/span>\u003Cspan style=\"color:#F97583\"> =\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'idle'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">message\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> string\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  |\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { \u003C/span>\u003Cspan style=\"color:#FFAB70\">status\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">; \u003C/span>\u003Cspan style=\"color:#FFAB70\">errors\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Record\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#79B8FF\">string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#79B8FF\">string\u003C/span>\u003Cspan style=\"color:#E1E4E8\">[]> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">export\u003C/span>\u003Cspan style=\"color:#F97583\"> async\u003C/span>\u003Cspan style=\"color:#F97583\"> function\u003C/span>\u003Cspan style=\"color:#B392F0\"> submitForm\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">prevState\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> ActionState\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, \u003C/span>\u003Cspan style=\"color:#FFAB70\">formData\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> FormData\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> Promise\u003C/span>\u003Cspan style=\"color:#E1E4E8\">&#x3C;\u003C/span>\u003Cspan style=\"color:#B392F0\">ActionState\u003C/span>\u003Cspan style=\"color:#E1E4E8\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">  // ...処理...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  if\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (error) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { status: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, errors: validationErrors };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  return\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> { status: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">, message: \u003C/span>\u003Cspan style=\"color:#9ECBFF\">'送信しました'\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>クライアント側では \u003Ccode>status\u003C/code> をチェックするだけで、エラー表示や成功メッセージの表示を安全に分岐できる。\u003C/p>\n\u003Ch2 id=\"応用網羅性チェックexhaustiveness-checking\">応用：網羅性チェック（Exhaustiveness Checking）\u003C/h2>\n\u003Cp>判別可能ユニオンと \u003Ccode>switch\u003C/code> 文を組み合わせる際、**「全てのパターンを網羅しているか」**をコンパイラにチェックさせることができる。\nこれには \u003Ccode>never\u003C/code> 型を利用する。\u003C/p>\n\u003Cpre class=\"astro-code github-dark\" style=\"background-color:#24292e;color:#e1e4e8; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> assertNever\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">x\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> never\u003C/span>\u003Cspan style=\"color:#E1E4E8\">)\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#79B8FF\"> never\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  throw\u003C/span>\u003Cspan style=\"color:#F97583\"> new\u003C/span>\u003Cspan style=\"color:#B392F0\"> Error\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#9ECBFF\">'Unexpected object: '\u003C/span>\u003Cspan style=\"color:#F97583\"> +\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> x);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">function\u003C/span>\u003Cspan style=\"color:#B392F0\"> render\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(\u003C/span>\u003Cspan style=\"color:#FFAB70\">state\u003C/span>\u003Cspan style=\"color:#F97583\">:\u003C/span>\u003Cspan style=\"color:#B392F0\"> State\u003C/span>\u003Cspan style=\"color:#E1E4E8\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">  switch\u003C/span>\u003Cspan style=\"color:#E1E4E8\"> (state.status) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'loading'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'Loading...'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'success'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> `Hello ${\u003C/span>\u003Cspan style=\"color:#E1E4E8\">state\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">data\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">name\u003C/span>\u003Cspan style=\"color:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    case\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> 'error'\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#9ECBFF\"> `Error: ${\u003C/span>\u003Cspan style=\"color:#E1E4E8\">state\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">error\u003C/span>\u003Cspan style=\"color:#9ECBFF\">.\u003C/span>\u003Cspan style=\"color:#E1E4E8\">message\u003C/span>\u003Cspan style=\"color:#9ECBFF\">}`\u003C/span>\u003Cspan style=\"color:#E1E4E8\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">    default\u003C/span>\u003Cspan style=\"color:#E1E4E8\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // もし将来 State に新しい型（例: 'idle'）が追加された場合、\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#6A737D\">      // ここで型エラーが発生するようになります。\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#F97583\">      return\u003C/span>\u003Cspan style=\"color:#B392F0\"> assertNever\u003C/span>\u003Cspan style=\"color:#E1E4E8\">(state);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"color:#E1E4E8\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\n\u003Cp>\u003Ccode>default\u003C/code>節で\u003Ccode>state\u003C/code>を\u003Ccode>never\u003C/code>型に代入しようとすることで、もし\u003Ccode>case\u003C/code>の漏れがあれば\u003Ccode>state\u003C/code>が\u003Ccode>never\u003C/code>にならず（残りの型になるため）、コンパイルエラーが発生する。\nこれで将来的な仕様変更によるバグを未然に防げる。\u003C/p>\n\u003Ch2 id=\"まとめ\">まとめ\u003C/h2>\n\u003Cul>\n\u003Cli>単純な Union 型ではなく、**判別可能ユニオン（Discriminated Union）**を使う\u003C/li>\n\u003Cli>共通のプロパティ（ディスクリミネータ）を持たせることで TypeScript が型を自動的に絞り込んでくれる\u003C/li>\n\u003Cli>これにより、\u003Ccode>?\u003C/code>や\u003Ccode>as\u003C/code>を使わずに安全にプロパティにアクセスでき、バグを減らせる\u003C/li>\n\u003Cli>\u003Ccode>never\u003C/code>型を使った網羅性チェックを導入すれば、保守性もさらに向上する\u003C/li>\n\u003C/ul>\n\u003Cp>型定義を少し工夫するだけで、コードの安全性と可読性は劇的に向上する。\u003C/p>",{"headings":66,"localImagePaths":119,"remoteImagePaths":120,"frontmatter":121,"imagePaths":124},[67,70,73,76,79,82,85,88,91,94,96,99,102,105,108,111,114,117],{"depth":29,"slug":68,"text":69},"そもそも-union-型とは","そもそも Union 型とは",{"depth":29,"slug":71,"text":72},"単純な-union-型の落とし穴","単純な Union 型の落とし穴",{"depth":29,"slug":74,"text":75},"判別可能ユニオンdiscriminated-unionの登場","判別可能ユニオン（Discriminated Union）の登場",{"depth":29,"slug":77,"text":78},"なぜこれが嬉しいのかtype-narrowing","なぜこれが嬉しいのか？（Type Narrowing）",{"depth":29,"slug":80,"text":81},"実践的なユースケース状態管理とドメインモデル","実践的なユースケース：状態管理とドメインモデル",{"depth":35,"slug":83,"text":84},"1-画面の-ui-状態管理","1. 画面の UI 状態管理",{"depth":35,"slug":86,"text":87},"2-ドメインモデル決済方法","2. ドメインモデル：決済方法",{"depth":29,"slug":89,"text":90},"深掘りoptional-property--の危険性","深掘り：Optional Property (?) の危険性",{"depth":35,"slug":92,"text":93},"なぜ--は危険なのか","なぜ ? は危険なのか",{"depth":35,"slug":95,"text":95},"ユニオン型による解決",{"depth":35,"slug":97,"text":98},"3-api-レスポンスのハンドリング","3. API レスポンスのハンドリング",{"depth":35,"slug":100,"text":101},"4-reducer-のアクションredux--usereducer","4. Reducer のアクション（Redux / useReducer）",{"depth":29,"slug":103,"text":104},"typescript-5x-と-satisfies","TypeScript 5.x と satisfies",{"depth":29,"slug":106,"text":107},"現代技術との接続zod-と-rsc","現代技術との接続：Zod と RSC",{"depth":35,"slug":109,"text":110},"zod-によるランタイム型チェック","Zod によるランタイム型チェック",{"depth":35,"slug":112,"text":113},"react-server-components-rsc","React Server Components (RSC)",{"depth":29,"slug":115,"text":116},"応用網羅性チェックexhaustiveness-checking","応用：網羅性チェック（Exhaustiveness Checking）",{"depth":29,"slug":118,"text":118},"まとめ",[],[],{"title":55,"description":56,"tags":122,"publishedAt":123},[58],["Date","2026-01-14T00:00:00.000Z"],[],"union_or_discriminatedunion.md"]